I admit I don't know much about this, so I'll leave this space to others who have more to say, but the basic thing to retain is that Marx sees religion as part of the super-structure along with culture, ideology, laws etc. This means that it's primarily a product of the base (structure), aka the means and relations of economic production. The famous quotation "religion is the opiate of the masses" has sort of a double meaning: organised religion is used by the bourgeoisie to keep the people docile and unaware of the class structure, but faith is also useful and necessary to alleviate the suffering of the exploited proletariat (just like opium is used as a painkiller). In an ideal communist society, where people are no longer exploited and suffering, religion would no longer be necessary, so it would either become redundant or disappear on its own.
